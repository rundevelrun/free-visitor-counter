import e,{useState as r,useEffect as t}from"react";function n(e,r,t,n){return new(t||(t=Promise))((function(o,a){function c(e){try{s(n.next(e))}catch(e){a(e)}}function i(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var r;e.done?o(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(c,i)}s((n=n.apply(e,r||[])).next())}))}function o(e,r){var t,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(t=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(e){i=[6,e],n=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}"function"==typeof SuppressedError&&SuppressedError;var a=function(a){var c=a.totalCountPrefix,i=void 0===c?"Total: ":c,s=a.totalCountSuffix,u=void 0===s?"":s,l=a.todayCountPrefix,f=void 0===l?"Today: ":l,d=a.todayCountSuffix,p=void 0===d?"":d,m=a.separator,h=void 0===m?" | ":m,y=a.showTotalFirst,v=void 0===y||y,g=a.style,b=void 0===g?{}:g,w=a.className,E=void 0===w?"":w,x=a.onLoad,P=r(null),C=P[0],S=P[1],T=r(!0),k=T[0],j=T[1],q=r(null),L=q[0],N=q[1];t((function(){n(void 0,void 0,void 0,(function(){var e,r,t,n,a,c,i,s,u,l,f;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,4,5]),e=window.location.hostname,r=window.location.pathname,t=document.title,n=document.referrer,a=Intl.DateTimeFormat().resolvedOptions().timeZone,c=O(document.referrer),i={domain:e,timezone:a,page_path:r,page_title:t,referrer:n,search_query:c},"localhost"===e||"127.0.0.1"===e?(S(s={dashboardUrl:"https://visitor.6developer.com/dashboard?domain=sample.com",totalCount:99999,todayCount:999}),x&&x(s),j(!1),[2]):[4,fetch("https://visitor.6developer.com/visit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})];case 1:if(!(u=o.sent()).ok)throw new Error("HTTP error! Status: ".concat(u.status));return[4,u.json()];case 2:return l=o.sent(),S(l),x&&x(l),[3,5];case 3:return f=o.sent(),N(f instanceof Error?f.message:"Unknown error"),console.error("Error fetching visitor count:",f),[3,5];case 4:return j(!1),[7];case 5:return[2]}}))}))}),[x]);var O=function(e){if(!e)return"";try{var r=new URL(e),t=r.hostname.toLowerCase();if(t.includes("google.com")||t.includes("google.co.kr")||t.includes("google.co.jp"))return r.searchParams.get("q")||"";if(t.includes("naver.com"))return r.searchParams.get("query")||"";if(t.includes("daum.net"))return r.searchParams.get("q")||"";if(t.includes("yahoo.com")||t.includes("yahoo.co.jp"))return r.searchParams.get("p")||"";if(t.includes("bing.com"))return r.searchParams.get("q")||"";if(t.includes("baidu.com"))return r.searchParams.get("wd")||"";if(t.includes("yandex.ru"))return r.searchParams.get("text")||""}catch(e){console.error("Error parsing referrer URL:",e)}return""};if(k)return e.createElement("span",{className:E,style:b},"Loading...");if(L||!C)return e.createElement("span",{className:E,style:b},"Error loading visitor count");var U="".concat(i).concat(C.totalCount).concat(u),F="".concat(f).concat(C.todayCount).concat(p),_=v?U:F,I=v?F:U,R=h.replace(/\\n/g,"\n");return e.createElement("a",{href:C.dashboardUrl,className:E,style:b,target:"_blank",rel:"noopener noreferrer"},_,R.includes("\n")?e.createElement(e.Fragment,null,e.createElement("br",null),I):e.createElement(e.Fragment,null,R,I))};export{a as FreeVisitorCounter,a as default};
//# sourceMappingURL=index.esm.js.map
